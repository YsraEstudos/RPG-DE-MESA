<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Zumbi - Informações</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        zombie: {
                            red: '#8B0000',
                            green: '#3D5C32',
                            gray: '#1E1E1E',
                            black: '#101010',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'blood-drip': 'blood-drip 8s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'blood-drip': {
                            '0%': { transform: 'translateY(-10px)', opacity: 0 },
                            '50%': { opacity: 1 },
                            '100%': { transform: 'translateY(30px)', opacity: 0 },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Special+Elite&display=swap');

        body {
            background-color: #101010;
            background-image:
                radial-gradient(circle at 50% 50%, rgba(139, 0, 0, 0.15) 0%, transparent 80%),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23320000' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .title-font {
            font-family: 'Creepster', cursive;
        }

        .content-font {
            font-family: 'Special Elite', cursive;
        }

        .blood-drip:before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 20px;
            background-color: #8B0000;
            border-radius: 50%;
            opacity: 0;
            animation: blood-drip 10s ease-in-out infinite;
        }

        .blood-splatter {
            pointer-events: none;
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            opacity: 0.7;
            z-index: -1;
        }

        .blood-1 {
            width: 100px; /* Reduced size */
            height: 100px; /* Reduced size */
            top: 5%; /* Adjusted position */
            left: 2%; /* Adjusted position */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%238B0000' d='M65.479,16.279c-7.547,3.145-10.334,4.127-4,14c6.334,9.873,10,16,2,18c-8,2-10-16-25-13c-7.5,1.5-6.5,11.5,1,17.5c8.5,6.818,13.5,18.045,6,20.5c-8,2.618-11.5-9-21-5c-6,3,2.334,11.334,6,15c4,4,10,8,21,1c12-7,20-1,22,2c1.666,2.501,11,9-2,12c-13,3-12,15,1,12c13-3,17-10,25-5c5.334,3.334,14.334,12.667,24,0c6.667-8.667-3.667-24.333-12-28c-6.667-2.934-10.333,7.333-4,11c6.333,3.667,0.333,14.667-9,11c-9.333-3.667-9-11.667-4-16c5-4.333,18.334-2.333,18-11c-0.334-8.667-18.666-16.667-29-11c-6,3.279-5,10-1,13c4,3,6,12-1,11c-5.6-0.8-0.334-9.334,4-14c4.334-4.666,3.667-11.333-2-15c-5.667-3.667-8.333-1.668-10,0c-3,3-6,4-6-0.5c0-4.5,8-9,12-9c5,0,10,3,10-3c0-5-7-8-14-4C67.479,11.779,67.813,15.279,65.479,16.279z'/%3E%3C/svg%3E");
            transform: rotate(45deg);
        }

        .blood-2 {
            width: 90px; /* Reduced size */
            height: 90px; /* Reduced size */
            bottom: 5%; /* Adjusted position */
            right: 2%; /* Adjusted position */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%238B0000' d='M50,16.4c-4.9,0-8.9,6.9-8.9,15.5c0,2.6,0.5,4.9,1.4,6.9c-6.4,1.5-11.1,7.2-11.1,13.9c0,7.9,6.4,14.4,14.4,14.4c3,0,5.8-0.9,8.2-2.5c2.3,1.6,5.1,2.5,8.2,2.5c8,0,14.4-6.4,14.4-14.4c0-6.7-4.6-12.3-10.9-13.9c0.8-2,1.3-4.3,1.3-6.9C66.9,23.3,62.9,16.4,58,16.4c-2.5,0-4.7,1.8-6.3,4.5C50.2,18.2,48,16.4,50,16.4z'/%3E%3C/svg%3E");
            transform: rotate(-20deg);
        }

        .blood-3 {
            width: 70px; /* Reduced size */
            height: 70px; /* Reduced size */
            top: 50%; /* Adjusted position */
            left: 2%; /* Adjusted position */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle fill='%238B0000' cx='50' cy='50' r='25' /%3E%3C/svg%3E");
        }

        /* Custom zombified scrollbar */
        ::-webkit-scrollbar {
            width: 8px; /* Reduced scrollbar width */
        }

        ::-webkit-scrollbar-track {
            background: #1E1E1E;
            border: 1px solid #3D5C32;
        }

        ::-webkit-scrollbar-thumb {
            background: #8B0000;
            border-radius: 4px; /* Reduced scrollbar thumb radius */
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #650000;
        }

        .input-field {
            background-color: rgba(30, 30, 30, 0.7);
            border: 1px solid #3D5C32;
            color: #fff;
            font-family: 'Special Elite', cursive;
            padding: 6px; /* Reduced input padding */
            border-radius: 4px;
            width: 100%;
            font-size: 0.9rem; /* Reduced input font size */
            transition: border-color 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #8B0000;
            box-shadow: 0 0 0 2px rgba(139, 0, 0, 0.3);
        }

        /* Dark mode styles */
        .dark .input-field {
            background-color: rgba(20, 20, 20, 0.8);
            color: #ddd;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 10px; /* Adjusted toast position */
            right: 10px; /* Adjusted toast position */
            padding: 8px 15px; /* Reduced toast padding */
            background-color: #3D5C32;
            color: white;
            font-family: 'Special Elite', cursive;
            border-radius: 4px; /* Reduced toast border radius */
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(100%);
            z-index: 1000;
            font-size: 0.9rem; /* Reduced toast font size */
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast.error {
            background-color: #8B0000;
        }
    </style>
</head>
<body class="min-h-screen dark content-font text-gray-300">
    <!-- Blood splatters - decorative elements -->
    <div class="blood-splatter blood-1"></div>
    <div class="blood-splatter blood-2"></div>
    <div class="blood-splatter blood-3"></div>

    <div class="container mx-auto px-3 py-4"> <!-- Reduced container padding -->
        <header class="mb-4 flex flex-col md:flex-row items-center justify-between"> <!-- Reduced header margin -->
            <div class="flex items-center mb-2 md:mb-0"> <!-- Reduced header item margin -->
                <a href="../index.html" class="text-zombie-green hover:text-zombie-red transition-colors duration-300 mr-2"> <!-- Reduced back button margin -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"> <!-- Reduced back button icon size -->
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
                    </svg>
                </a>
                <h1 class="title-font text-zombie-red text-3xl md:text-3xl">Informações</h1> <!-- Reduced header title size -->
            </div>
            <div class="flex items-center gap-2">
                <div id="autoSaveIndicator" class="text-gray-400 flex items-center text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 saving-icon hidden animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span class="saved-text">Salvo</span>
                </div>
                <button id="undoBtn" class="px-3 py-1 bg-zombie-green hover:bg-zombie-red text-white rounded transition-colors duration-300 flex items-center text-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                    </svg>
                    Desfazer
                </button>
            </div>
        </header>

        <!-- INFORMAÇÕES BÁSICAS -->
        <section class="mb-4 bg-zombie-gray bg-opacity-80 rounded-lg p-3 border-2 border-zombie-green"> <!-- Reduced section margin and padding -->
            <h2 class="title-font text-zombie-red text-xl mb-2">INFORMAÇÕES BÁSICAS</h2> <!-- Reduced section title margin -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"> <!-- Reduced grid gap -->
                <div>
                    <label class="block mb-0.5 text-sm">Nome do Personagem:</label> <!-- Reduced label margin -->
                    <input type="text" id="nome" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Idade:</label>
                    <input type="number" id="idade" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Altura:</label>
                    <input type="text" id="altura" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Peso:</label>
                    <input type="text" id="peso" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Sexo:</label>
                    <select id="sexo" class="input-field auto-save text-sm">
                        <option value="">Selecione...</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Feminino">Feminino</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">TAMPINHAS:</label>
                    <input type="number" id="tampinhas" class="input-field auto-save text-sm" autocomplete="off">
                </div>
            </div>
        </section>

        <!-- ATRIBUTOS -->
        <section class="mb-4 bg-zombie-gray bg-opacity-80 rounded-lg p-3 border-2 border-zombie-green"> <!-- Reduced section margin and padding -->
            <h2 class="title-font text-zombie-red text-xl mb-2">ATRIBUTOS</h2> <!-- Reduced section title margin -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"> <!-- Reduced grid gap -->
                <div>
                    <label class="block mb-0.5 text-sm">FORÇA:</label> <!-- Reduced label margin -->
                    <input type="number" id="forca" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">GUERRA:</label>
                    <input type="number" id="guerra" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">PERCEPÇÃO:</label>
                    <input type="number" id="percepcao" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">LÁBIA:</label>
                    <input type="number" id="labia" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">INTELIGÊNCIA:</label>
                    <input type="number" id="inteligencia" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">FORÇA DE VONTADE:</label>
                    <input type="number" id="forca_vontade" class="input-field auto-save text-sm" autocomplete="off">
                </div>
            </div>
        </section>

        <!-- PERÍCIAS -->
        <section class="mb-4 bg-zombie-gray bg-opacity-80 rounded-lg p-3 border-2 border-zombie-green"> <!-- Reduced section margin and padding -->
            <h2 class="title-font text-zombie-red text-xl mb-2">PERÍCIAS</h2> <!-- Reduced section title margin -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2"> <!-- Reduced grid gap -->
                <div>
                    <label class="block mb-0.5 text-sm">Armeiro (01%):</label> <!-- Reduced label margin -->
                    <input type="number" id="armeiro" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Encontrar (25%):</label>
                    <input type="number" id="encontrar" class="input-field auto-save text-sm" value="25" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Arrombamento (01%):</label>
                    <input type="number" id="arrombamento" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Equilíbrio (40%):</label>
                    <input type="number" id="equilibrio" class="input-field auto-save text-sm" value="40" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Computação (01%):</label>
                    <input type="number" id="computacao" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Furtividade (20%):</label>
                    <input type="number" id="furtividade" class="input-field auto-save text-sm" value="20" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Conhecimentos Mund. (30%):</label>
                    <input type="number" id="conhecimentos" class="input-field auto-save text-sm" value="30" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Horticultura (01%):</label>
                    <input type="number" id="horticultura" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Pedagogia (10%):</label>
                    <input type="number" id="pedagogia" class="input-field auto-save text-sm" value="10" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Ocultar (15%):</label>
                    <input type="number" id="ocultar" class="input-field auto-save text-sm" value="15" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Sobrevivencialismo (25%):</label>
                    <input type="number" id="sobrevivencialismo" class="input-field auto-save text-sm" value="25" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Bater-carteira (05%):</label>
                    <input type="number" id="bater_carteira" class="input-field auto-save text-sm" value="5" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Pescaria (01%):</label>
                    <input type="number" id="pescaria" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Artes Marciais:</label>
                    <select id="artes_marciais" class="input-field auto-save text-sm">
                        <option value="">Escolha</option>
                        <option value="Karate">Karate</option>
                        <option value="Jiu-Jitsu">Jiu-Jitsu</option>
                        <option value="Muay Thai">Muay Thai</option>
                        <option value="Boxe">Boxe</option>
                        <option value="Krav Maga">Krav Maga</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Reparo Mecânico (15%):</label>
                    <input type="number" id="reparo_mecanico" class="input-field auto-save text-sm" value="15" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Idioma:</label>
                    <select id="idioma" class="input-field auto-save text-sm">
                        <option value="">Escolha</option>
                        <option value="Inglês">Inglês</option>
                        <option value="Espanhol">Espanhol</option>
                        <option value="Francês">Francês</option>
                        <option value="Alemão">Alemão</option>
                        <option value="Japonês">Japonês</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Reparo Eletrônico (01%):</label>
                    <input type="number" id="reparo_eletronico" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
            </div>
        </section>

        <!-- OUTRAS PERÍCIAS -->
        <section class="mb-4 bg-zombie-gray bg-opacity-80 rounded-lg p-3 border-2 border-zombie-green"> <!-- Reduced section margin and padding -->
            <h2 class="title-font text-zombie-red text-xl mb-2">OUTRAS PERÍCIAS</h2> <!-- Reduced section title margin -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2"> <!-- Reduced grid gap -->
                <div>
                    <label class="block mb-0.5 text-sm">Sorte (25%):</label> <!-- Reduced label margin -->
                    <input type="number" id="sorte" class="input-field auto-save text-sm" value="25" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Navegação (10%):</label>
                    <input type="number" id="navegacao" class="input-field auto-save text-sm" value="10" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Rastrear (10%):</label>
                    <input type="number" id="rastrear" class="input-field auto-save text-sm" value="10" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Pulo (30%):</label>
                    <input type="number" id="pulo" class="input-field auto-save text-sm" value="30" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Química (01%):</label>
                    <input type="number" id="quimica" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Pesquisar Biblioteca (25%):</label>
                    <input type="number" id="pesquisar_biblioteca" class="input-field auto-save text-sm" value="25" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Primeiros Socorros (20%):</label>
                    <input type="number" id="primeiros_socorros" class="input-field auto-save text-sm" value="20" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Psicologia (05%):</label>
                    <input type="number" id="psicologia" class="input-field auto-save text-sm" value="5" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Nadar (25%):</label>
                    <input type="number" id="nadar" class="input-field auto-save text-sm" value="25" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Zoologia (01%):</label>
                    <input type="number" id="zoologia" class="input-field auto-save text-sm" value="1" autocomplete="off">
                </div>
            </div>
        </section>

        <!-- PILOTAR -->
        <section class="mb-4 bg-zombie-gray bg-opacity-80 rounded-lg p-3 border-2 border-zombie-green"> <!-- Reduced section margin and padding -->
            <h2 class="title-font text-zombie-red text-xl mb-2">PILOTAR</h2> <!-- Reduced section title margin -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2"> <!-- Reduced grid gap -->
                <div>
                    <label class="block mb-0.5 text-sm">Motos (10%):</label> <!-- Reduced label margin -->
                    <input type="number" id="motos" class="input-field auto-save text-sm" value="10" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Carros (15%):</label>
                    <input type="number" id="carros" class="input-field auto-save text-sm" value="15" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Barcos (10%):</label>
                    <input type="number" id="barcos" class="input-field auto-save text-sm" value="10" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">Cavalos (10%):</label>
                    <input type="number" id="cavalos" class="input-field auto-save text-sm" value="10" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">??? (0%):</label>
                    <input type="number" id="pilotar_outro" class="input-field auto-save text-sm" value="0" autocomplete="off">
                </div>
            </div>
        </section>

        <!-- OUTROS ATRIBUTOS -->
        <section class="mb-4 bg-zombie-gray bg-opacity-80 rounded-lg p-3 border-2 border-zombie-green"> <!-- Reduced section margin and padding -->
            <h2 class="title-font text-zombie-red text-xl mb-2">OUTROS ATRIBUTOS</h2> <!-- Reduced section title margin -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-2"> <!-- Reduced grid gap -->
                <div>
                    <label class="block mb-0.5 text-sm">MVT BASE:</label> <!-- Reduced label margin -->
                    <input type="number" id="mvt_base" class="input-field auto-save text-sm" autocomplete="off">
                </div>
                <div>
                    <label class="block mb-0.5 text-sm">BR%:</label>
                    <input type="number" id="br" class="input-field auto-save text-sm" autocomplete="off">
                </div>
            </div>
        </section>

        <!-- HANDICAPS OU TRAUMAS -->
        <section class="mb-4 bg-zombie-gray bg-opacity-80 rounded-lg p-3 border-2 border-zombie-green"> <!-- Reduced section margin and padding -->
            <h2 class="title-font text-zombie-red text-xl mb-2">HANDICAPS OU TRAUMAS:</h2> <!-- Reduced section title margin -->
            <textarea id="handicaps" class="input-field auto-save h-16 text-sm" placeholder="Descreva aqui os handicaps ou traumas do seu personagem..."></textarea> <!-- Reduced textarea height and font size -->
        </section>

        <!-- Toast notification -->
        <div id="toast" class="toast">Alterações salvas</div>
    </div>

    <footer class="py-3 text-center text-gray-500 text-sm"> <!-- Reduced footer padding -->
        <p>Survivor's Log -- Mantenha-se vivo, mantenha-se humano</p>
    </footer>

    <script>
        // Verificar preferência de tema escuro
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Sistema de armazenamento com histórico para desfazer ações
        // Usando sessionStorage ao invés de localStorage para evitar problemas de quota
        const STORAGE_KEY = 'rpg_zombie_info_data';
        const HISTORY_KEY = 'rpg_zombie_info_history';
        const MAX_HISTORY = 10;

        let formData = {};
        let history = [];
        let isStorageAvailable = true;

        // Verificar se o Storage está disponível
        function checkStorageAvailability() {
            try {
                const testKey = '__storage_test__';
                sessionStorage.setItem(testKey, testKey);
                sessionStorage.removeItem(testKey);
                return true;
            } catch (e) {
                return false;
            }
        }

        // Elementos da UI
        const undoBtn = document.getElementById('undoBtn');
        const toast = document.getElementById('toast');
        const savingIcon = document.querySelector('.saving-icon');
        const savedText = document.querySelector('.saved-text');

        // Função para mostrar notificação
        function showToast(message, isError = false) {
            toast.textContent = message;
            toast.className = isError ? 'toast error show' : 'toast show';

            setTimeout(() => {
                toast.className = 'toast';
            }, 2000);
        }

        // Função para mostrar indicador de salvamento
        function showSavingIndicator() {
            savingIcon.classList.remove('hidden');
            savedText.textContent = 'Salvando...';
        }

        function showSavedIndicator() {
            savingIcon.classList.add('hidden');
            savedText.textContent = 'Salvo';
        }

        // Salvar em memória quando o storage não está disponível
        const memoryStorage = {
            data: {},
            setItem(key, value) {
                this.data[key] = value;
            },
            getItem(key) {
                return this.data[key] || null;
            },
            removeItem(key) {
                delete this.data[key];
            }
        };

        // Função para obter o storage apropriado
        function getStorage() {
            return isStorageAvailable ? sessionStorage : memoryStorage;
        }

        // Carregar dados salvos
        function loadFormData() {
            try {
                const storage = getStorage();
                const savedData = storage.getItem(STORAGE_KEY);

                if (savedData) {
                    try {
                        formData = JSON.parse(savedData);

                        // Preencher os campos com os dados salvos
                        Object.keys(formData).forEach(id => {
                            const element = document.getElementById(id);
                            if (element) {
                                element.value = formData[id];
                            }
                        });
                    } catch (parseError) {
                        console.error('Erro ao parsear dados salvos:', parseError);
                        formData = {}; // Reset em caso de erro
                    }
                }

                // Carregar histórico
                const savedHistory = storage.getItem(HISTORY_KEY);
                if (savedHistory) {
                    try {
                        history = JSON.parse(savedHistory);
                    } catch (parseError) {
                        console.error('Erro ao parsear histórico:', parseError);
                        history = []; // Reset em caso de erro
                    }
                }

                // Desabilitar botão de desfazer se não houver histórico
                undoBtn.disabled = history.length === 0;
                undoBtn.classList.toggle('opacity-50', history.length === 0);
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showToast('Erro ao carregar dados. Usando armazenamento temporário.', true);
                isStorageAvailable = false;
            }
        }

        // Salvar dados do formulário
        function saveFormData() {
            try {
                showSavingIndicator();

                // Coletar dados atuais do formulário
                const inputs = document.querySelectorAll('.auto-save');
                const newData = {};

                inputs.forEach(input => {
                    newData[input.id] = input.value;
                });

                // Capturar estado atual antes de alterar
                if (Object.keys(formData).length > 0) {
                    try {
                        // Adicionar estado atual ao histórico antes de modificar
                        history.push(JSON.stringify(formData));

                        // Manter apenas os últimos MAX_HISTORY estados
                        if (history.length > MAX_HISTORY) {
                            history.shift();
                        }

                        // Atualizar estado do botão de desfazer
                        undoBtn.disabled = false;
                        undoBtn.classList.remove('opacity-50');
                    } catch (historyError) {
                        console.error('Erro ao manipular histórico:', historyError);
                        // Continue com a operação de salvamento mesmo com erro no histórico
                    }
                }

                // Atualizar formData com os novos valores
                formData = newData;

                // Salvar dados
                const storage = getStorage();
                try {
                    storage.setItem(STORAGE_KEY, JSON.stringify(formData));
                    storage.setItem(HISTORY_KEY, JSON.stringify(history));
                } catch (storageError) {
                    if (storageError.name === 'QuotaExceededError' ||
                        storageError.name === 'NS_ERROR_DOM_QUOTA_REACHED') {
                        console.error('Limite de armazenamento excedido:', storageError);
                        isStorageAvailable = false;
                        // Tentar novamente com memoryStorage
                        memoryStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
                        memoryStorage.setItem(HISTORY_KEY, JSON.stringify(history));
                        showToast('Armazenamento limitado. Dados mantidos apenas nesta sessão.', true);
                    } else {
                        throw storageError;
                    }
                }

                // Indicar salvamento concluído
                setTimeout(() => {
                    showSavedIndicator();
                }, 500);
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                showToast('Erro ao salvar dados', true);
                showSavedIndicator();
            }
        }

        // Desfazer última ação
        function undoLastAction() {
            try {
                if (history.length === 0) {
                    showToast('Não há ações para desfazer', true);
                    return;
                }

                // Recuperar o último estado do histórico
                const lastState = history.pop();

                try {
                    // Aplicar estado anterior
                    formData = JSON.parse(lastState);

                    // Atualizar campos no formulário
                    Object.keys(formData).forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.value = formData[id];
                        }
                    });

                    // Salvar as alterações
                    const storage = getStorage();
                    storage.setItem(STORAGE_KEY, JSON.stringify(formData));
                    storage.setItem(HISTORY_KEY, JSON.stringify(history));

                    // Desabilitar botão de desfazer se não houver mais histórico
                    undoBtn.disabled = history.length === 0;
                    undoBtn.classList.toggle('opacity-50', history.length === 0);

                    showToast('Ação desfeita');
                } catch (parseError) {
                    console.error('Erro ao processar estado anterior:', parseError);
                    showToast('Erro ao desfazer ação', true);
                }

            } catch (error) {
                console.error('Erro ao desfazer ação:', error);
                showToast('Erro ao desfazer ação', true);
            }
        }

        // Função para atrasar salvamento durante digitação (debounce)
        function debounce(func, delay) {
            let timer;
            return function () {
                const context = this;
                const args = arguments;
                clearTimeout(timer);
                timer = setTimeout(() => {
                    func.apply(context, args);
                }, delay);
            };
        }

        // Configurar listener para salvamento com atraso
        const debouncedSave = debounce(saveFormData, 800);

        // Configurar listeners para eventos
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar disponibilidade de armazenamento
            isStorageAvailable = checkStorageAvailability();

            if (!isStorageAvailable) {
                showToast('Armazenamento persistente não disponível. Usando armazenamento temporário.', true);
            }

            // Carregar dados salvos
            loadFormData();

            // Configurar auto-save para todos os campos
            const inputs = document.querySelectorAll('.auto-save');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    showSavingIndicator();
                    debouncedSave();
                });

                // Salvar imediatamente quando o campo perde o foco
                input.addEventListener('blur', saveFormData);
            });

            // Botão para desfazer
            undoBtn.addEventListener('click', undoLastAction);
        });
    </script>
</body>
</html>